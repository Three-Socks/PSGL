{% assign competitions = (site.competitions | sort: 'date') %}

{% capture menu_list %}
	{% for menu in site.data.navigation.menu %}
		{{menu.title}}|{{menu.url}}|{{menu.icon}}|{{menu.standings}}|{{menu.twitter}}|{{menu.youtube}}
		{% if forloop.index == 1 %}
			{% for comp in competitions %}
				{% if comp.menu_hide != true and comp.signup_url != '' and comp.signup_url != null %}
					::{{comp.menu_title}}|{{comp.signup_url}}|{{comp.menu_icon}}
				{% endif %}

				{% for calendar in site.calendars %}
					{% if calendar.category == comp.title and calendar.menu_hide != true %}
						::{{calendar.menu_title}}|{{calendar.url}}|{{calendar.menu_icon}}
					{% endif %}
				{% endfor %}
				
				{% assign current_season = site.seasons | where: "category", comp.title %}
				{% for season in current_season %}
					{% if season and season.menu_hide != true %}
						::{{season.menu_title}}|{{season.url}}|{{season.menu_icon}}
					{% endif %}
				{% endfor %}
			{% endfor %}
		{% endif%}
		{% if forloop.last == false %}::{% endif%}
	{% endfor %}
{% endcapture %}
{% assign menu_array = menu_list | split: '::'%}
<nav id="menu_nav">
	<ul id="main_menu" role="menubar">
	{% for item in menu_array %}
		{%- assign menu_vals = item | split: '|' -%}

		{%- assign title = menu_vals[0] | strip -%}
		{%- assign twitter = menu_vals[4] | strip -%}
		{%- assign youtube = menu_vals[5] | strip -%}

		{%- if twitter == 'true' -%}
			{%- assign url = 'https://twitter.com/' | append: site.data.settings.twitter | remove:'@' | strip -%}
			{%- assign target = 'rel="noopener noreferrer" target="_blank"' -%}
		{% elsif youtube == 'true' %}
			{%- assign url = 'https://www.youtube.com/channel/' | append: site.data.settings.youtube | append: '?sub_confirmation=1' | strip -%}
			{%- assign target = 'rel="noopener noreferrer" target="_blank"' -%}
		{% else %}
			{%- assign url = menu_vals[1] | strip -%}
			{%- assign target = 'target="_self"'' -%}
		{% endif %}

		{%- assign icon = menu_vals[2] | strip -%}
		{%- assign standings = menu_vals[3] | strip -%}

		{%- if standings == 'true' -%}
			{% assign class = 'linklevel1 subsections' %}
		{% else %}
			{% assign class = 'linklevel1' %}
		{%- endif -%}

		{%- if url == "/" -%}
			{% if page.url == "/" %}
				{% assign class = class | append: ' active' %}
			{% endif %}
		{% elsif url != '' and url != null and page.url contains url %}
			{% assign class = class | append: ' active' %}
		{% endif %}
		<li class="listlevel1">
			<a class="{{ class }}" href="{{ url }}" {{ target }}><i class="icon icon-menu icon-lg" style='background: url("{{ icon }}") no-repeat;background-size:100%;' title="{{ title }}"></i> <span class="button_title">{{ title }}</span></a>
		</li>
	{% endfor %}
	</ul>
</nav>
