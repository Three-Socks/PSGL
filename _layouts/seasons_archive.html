---
layout: default
---

{% assign current_comp = site.competitions | where: "slug", page.category %}
{% assign current_season = site.seasons | where: "category", page.category %}

<header class="category_header">
	{{ current_comp.first.title }} {{ page.title | escape }}
</header>
<article class="post_wrapper blogposts">
	<div id="standings_view" class="psgl_content center">
	{{ content }}
	</div>
	<nav>
	<ul class="league_list">
	</ul>
	</nav>
	{%- if current_comp.first.halloffame != null and current_comp.first.halloffame != "" -%}
	<div class="psgl_content_left">
		<div class="psgl_content">
			<hr/>
			<a href="{{ current_comp.first.halloffame }}"><img src="{{ current_comp.first.halloffame }}" alt="" /></a><br />
			<a href="{{ current_comp.first.halloffame }}"><span>Full Size</span></a>
		</div>
	</div>
	{% endif %}
	{%- if current_season.size > 1 -%}
	<div class="psgl_content_right">
		<div class="psgl_content">
			<hr/>
			<div class="standings_header">Archives</div>
			{% for season in current_season %}
				{% if season.title != page.title %}
					<div class="standings_link"><a href="{{ season.url }}">{{ season.title | replace: " Standings" }}</a></div>
				{% endif %}
			{% endfor %}
		</div>
	</div>
	{% endif %}
</article>
<script src="/assets/js/season-fetch.js"></script>
<script>
	$(document).ready(async () =>
	{
		const standings_view = $('#standings_view');
		standings_view.html('Loading...');

		try
		{
			let standings_json = JSON.parse('{{ page.tiers | jsonify }}');

			for (let standing of standings_json)
			{
				standing.data = {};
				standing.data.drivers = document.location.origin + '/{{ page.category }}/{{ page.slug }}/' + standing.name + '-driver-standings.png';
				standing.data.constructors = document.location.origin + '/{{ page.category }}/{{ page.slug }}/' + standing.name + '-constructor-standings.png';
				standing.data.last_updated = `{{ page.date | date: '%a %B %d %Y' }}`;
			}

			if (!standings_json)
				throw 'standings_json false';

			season_fetch(standings_view, standings_json, '{{ page.url }}', '{{ current_comp.first.title }} {{ page.title | escape }}');
		}
		catch (e)
		{
			console.error(e);
			standings_view.html('Error loading standings.');
		}
	});
</script>